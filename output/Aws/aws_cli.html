<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>aws_cli - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Aws">Aws</a>&nbsp;&#187;&nbsp;aws_cli
    <span class="updated">Page Updated&nbsp;
      2020-06-06 18:00
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">aws_cli</div>

  <p>[toc]</p>
<h1 id="aws-cli">AWS CLI</h1>
<h2 id="linux">Linux</h2>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">curl</span> <span class="s">&quot;https://s3.amazonaws.com/aws-cli/awscli-bundle.zip&quot;</span> <span class="o">-</span><span class="n">o</span> <span class="s">&quot;awscli-bundle.zip&quot;</span>
<span class="err">$</span> <span class="n">unzip</span> <span class="n">awscli</span><span class="o">-</span><span class="n">bundle</span><span class="p">.</span><span class="n">zip</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">awscli</span><span class="o">-</span><span class="n">bundle</span><span class="o">/</span><span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">aws</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">aws</span>
</pre></div>


<p>Add your Access Key ID and Secret Access Key to ~/<code>.aws/config</code> using this format:</p>
<div class="hlcode"><pre><span class="k">[default]</span>
<span class="na">aws_access_key_id</span> <span class="o">=</span> <span class="s">&lt;access key id&gt;</span>
<span class="na">aws_secret_access_key</span> <span class="o">=</span> <span class="s">&lt;secret access key&gt;</span>
<span class="na">region</span> <span class="o">=</span> <span class="s">us-east-1</span>
</pre></div>


<p>Protect the config file:</p>
<div class="hlcode"><pre><span class="n">chmod</span> <span class="mi">600</span> <span class="o">~/</span><span class="p">.</span><span class="n">aws</span><span class="o">/</span><span class="n">config</span>
</pre></div>


<p>Optionally, you can set an environment variable pointing to the config file. This is especially important if you want to keep it in a non-standard location. For future convenience, also add this line to your ~/.bashrc file:</p>
<div class="hlcode"><pre><span class="n">export</span> <span class="n">AWS_CONFIG_FILE</span><span class="o">=</span><span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">aws</span><span class="o">/</span><span class="n">config</span>
</pre></div>


<h2 id="mac-osx">Mac OSX</h2>
<div class="hlcode"><pre><span class="n">curl</span> <span class="s">&quot;https://s3.amazonaws.com/aws-cli/awscli-bundle.zip&quot;</span> <span class="o">-</span><span class="n">o</span> <span class="s">&quot;awscli-bundle.zip&quot;</span>

<span class="n">unzip</span> <span class="n">awscli</span><span class="o">-</span><span class="n">bundle</span><span class="p">.</span><span class="n">zip</span>

<span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">awscli</span><span class="o">-</span><span class="n">bundle</span><span class="o">/</span><span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">aws</span> <span class="o">-</span><span class="n">b</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">aws</span>
</pre></div>


<p>Example</p>
<p><img alt="image-20200310181746852" src="aws_cli.assets/image-20200310181746852.png" /></p>
<h1 id="aws-cli-profile">AWS CLI Profile</h1>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cat</span> <span class="o">~/</span><span class="p">.</span><span class="n">aws</span><span class="o">/</span><span class="n">credentials</span>
<span class="p">[</span><span class="n">dp</span><span class="p">]</span>
<span class="n">aws_access_key_id</span> <span class="o">=</span> <span class="n">xx</span>
<span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="n">xx</span>
<span class="p">[</span><span class="n">dp</span><span class="o">-</span><span class="n">stg</span><span class="p">]</span>
<span class="n">aws_access_key_id</span> <span class="o">=</span> <span class="n">xx</span>
<span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="n">xx</span>
<span class="p">[</span><span class="n">custom_dp_da_sts</span><span class="p">]</span>
<span class="n">aws_access_key_id</span> <span class="o">=</span> <span class="n">xx</span>
<span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="n">xx</span>
</pre></div>


<div class="hlcode"><pre><span class="err">$</span> <span class="n">aws</span> <span class="n">configure</span> <span class="o">--</span><span class="n">profile</span> <span class="n">custom_bd_da_sts</span>
<span class="n">AWS</span> <span class="n">Access</span> <span class="n">Key</span> <span class="n">ID</span> <span class="p">[</span><span class="n">None</span><span class="p">]</span><span class="o">:</span> <span class="n">xx</span>
<span class="n">AWS</span> <span class="n">Secret</span> <span class="n">Access</span> <span class="n">Key</span> <span class="p">[</span><span class="n">None</span><span class="p">]</span><span class="o">:</span> <span class="n">xx</span>
<span class="n">Default</span> <span class="n">region</span> <span class="n">name</span> <span class="p">[</span><span class="n">None</span><span class="p">]</span><span class="o">:</span> <span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span>
<span class="n">Default</span> <span class="n">output</span> <span class="n">format</span> <span class="p">[</span><span class="n">None</span><span class="p">]</span><span class="o">:</span> <span class="n">json</span>
</pre></div>


<div class="hlcode"><pre><span class="err">$</span> <span class="n">aws</span> <span class="n">sts</span> <span class="n">get</span><span class="o">-</span><span class="n">caller</span><span class="o">-</span><span class="n">identity</span> <span class="o">--</span><span class="n">profile</span> <span class="n">custom_bd_da_sts</span>
</pre></div>


<h2 id="assume-role">Assume Role</h2>
<div class="hlcode"><pre><span class="n">aws</span> <span class="n">sts</span> <span class="n">assume</span><span class="o">-</span><span class="n">role</span> <span class="o">--</span><span class="n">role</span><span class="o">-</span><span class="n">arn</span> <span class="s">&quot;arn:aws:iam::680404271483:role/ASSUME_ROLE&quot;</span> <span class="o">--</span><span class="n">role</span><span class="o">-</span><span class="n">session</span><span class="o">-</span><span class="n">name</span> <span class="n">AWSCLI</span><span class="o">-</span><span class="n">Session</span>
</pre></div>


<p>Replace with above output</p>
<div class="hlcode"><pre><span class="n">export</span> <span class="n">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="n">RoleAccessKeyID</span>
<span class="n">export</span> <span class="n">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="n">RoleSecretKey</span>
<span class="n">export</span> <span class="n">AWS_SESSION_TOKEN</span><span class="o">=</span><span class="n">RoleSessionToken</span>

<span class="n">aws</span> <span class="n">sts</span> <span class="n">get</span><span class="o">-</span><span class="n">caller</span><span class="o">-</span><span class="n">identity</span>
<span class="n">aws</span> <span class="n">s3</span> <span class="n">ls</span> <span class="n">s3</span><span class="o">:</span><span class="c1">//ASSUMED_BUCKET</span>
</pre></div>


<p>To return to the IAM user, remove the environment variables</p>
<div class="hlcode"><pre><span class="n">unset</span> <span class="n">AWS_ACCESS_KEY_ID</span> <span class="n">AWS_SECRET_ACCESS_KEY</span> <span class="n">AWS_SESSION_TOKEN</span>
<span class="n">aws</span> <span class="n">sts</span> <span class="n">get</span><span class="o">-</span><span class="n">caller</span><span class="o">-</span><span class="n">identity</span>
</pre></div>


<p>Reference to https://aws.amazon.com/premiumsupport/knowledge-center/iam-assume-role-cli/?nc1=h_ls</p>
<h1 id="ssm">SSM</h1>
<div class="hlcode"><pre><span class="nt">aws</span> <span class="nt">ssm</span> <span class="nt">get-parameters</span> <span class="nt">--names</span> <span class="o">/</span><span class="nt">pkg</span>
<span class="p">{</span>
    <span class="s2">&quot;InvalidParameters&quot;</span><span class="o">:</span> <span class="cp">[]</span><span class="o">,</span>
    <span class="s2">&quot;Parameters&quot;</span><span class="o">:</span> <span class="cp">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;/pkg&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LastModifiedDate&quot;</span><span class="p">:</span> <span class="mf">1589791491.805</span><span class="p">,</span>
            <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;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&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;SecureString&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ARN&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:ssm:us-east-1:982645107754:parameter/pkg&quot;</span>
        <span class="p">}</span>
    <span class="cp">]</span>
<span class="p">}</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-12-12 14:54:32</p>
      </span>
    </div>

    
    
  </body>
</html>