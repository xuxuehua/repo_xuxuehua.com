<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>s3 - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Aws">Aws</a>&nbsp;&#187;&nbsp;s3
    <span class="updated">Page Updated&nbsp;
      2019-06-21 08:52
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">s3</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#simple-storage-service">Simple Storage Service</a><ul>
<li><a href="#characteristic">Characteristic</a></li>
<li><a href="#buckets">buckets</a></li>
<li><a href="#common-use-scenarios">Common Use Scenarios</a></li>
<li><a href="#object-keys">Object Keys</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#storage-classes">Storage Classes</a></li>
<li><a href="#ebs-vs-s3">EBS vs S3</a></li>
</ul>
</li>
<li><a href="#s3-glacier">S3 Glacier</a></li>
<li><a href="#s3-lifecycle">S3 Lifecycle</a><ul>
<li><a href="#s3-standard">S3 Standard</a></li>
<li><a href="#s3-standard-ia">S3 Standard-IA</a></li>
<li><a href="#s3-glacier_1">S3 Glacier</a></li>
<li><a href="#performance-across-the-s3-storage-classes">Performance across the S3 Storage Classes</a></li>
<li><a href="#cost-considerations">Cost considerations</a></li>
</ul>
</li>
<li><a href="#aws-s3-cli">aws s3 cli</a><ul>
<li><a href="#ls">ls</a></li>
<li><a href="#cp">cp</a></li>
<li><a href="#_1"></a></li>
<li><a href="#sync">sync</a></li>
</ul>
</li>
<li><a href="#s3-operation">S3 operation</a><ul>
<li><a href="#etags">etags</a><ul>
<li><a href="#verify">verify</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="simple-storage-service">Simple Storage Service</h1>
<p>AWS rates their S3 standard storage class at 99.999999999% durability. Translated into English, this means that if you store, say 10,000 objects with them, one might get lost every 10 million years or so</p>
<h2 id="characteristic">Characteristic</h2>
<p>Store and retrieve any amount of data, any time from anywhere on the web</p>
<p>Objects up to 5TB no bucket size limit</p>
<p>Estimate monthly bill using the AWS Simple Monthly Calculator</p>
<h2 id="buckets">buckets</h2>
<p>Buckets are globally unique containers for everything that you store in S3</p>
<p>The bucket name should be DNS compliance </p>
<h2 id="common-use-scenarios">Common Use Scenarios</h2>
<p>Storage and Backup </p>
<p>Application File Hosting</p>
<p>Media Hosting</p>
<p>Software Delivery</p>
<p>Store AMIs and Snapshots</p>
<h2 id="object-keys">Object Keys</h2>
<p><img alt="image-20200403212949904" src="s3.assets/image-20200403212949904.png" /></p>
<h2 id="security">Security</h2>
<p>Control buckets and objects with Access Control Lists (ACLs), Bucket policies and Identity  and Access Management(IAM) policies</p>
<p>Upload/Download data to S3 with SSL encrypted endpoints</p>
<h2 id="storage-classes">Storage Classes</h2>
<p><img alt="img" src="s3.assets/gy3ecV.jpg" /></p>
<h2 id="ebs-vs-s3">EBS vs S3</h2>
<p><img alt="img" src="s3.assets/NmzLpQ.jpg" /></p>
<h1 id="s3-glacier">S3 Glacier</h1>
<p>For archiving data</p>
<p>For very infrequently accessed data</p>
<p>Data retrieval time of several hours</p>
<p>Just as durable as S3</p>
<p>Much less cost than S3</p>
<h1 id="s3-lifecycle">S3 Lifecycle</h1>
<ul>
<li>The S3 Standard storage class to any other storage class.</li>
<li>Any storage class to the S3 Glacier or S3 Glacier Deep Archive storage classes.</li>
<li>The S3 Standard-IA storage class to the S3 Intelligent-Tiering or S3 One Zone-IA storage classes.</li>
<li>The S3 Intelligent-Tiering storage class to the S3 One Zone-IA storage class.</li>
<li>The S3 Glacier storage class to the S3 Glacier Deep Archive storage class.</li>
</ul>
<p><img alt="image-20200619122430932" src="s3.assets/image-20200619122430932.png" /></p>
<h2 id="s3-standard">S3 Standard</h2>
<p>S3 Standard offers high durability, availability, and performance object storage for frequently accessed data. Because it delivers low latency and high throughput, S3 Standard is appropriate for a wide variety of use cases, including cloud applications, dynamic websites, content distribution, mobile and gaming applications, and big data analytics.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Low latency and high throughput performance</li>
<li>Designed for durability of 99.999999999% of objects across multiple Availability Zones</li>
<li>Resilient against events that impact an entire Availability Zone</li>
<li>Designed for 99.99% availability over a given year</li>
<li>Backed with the <a href="https://aws.amazon.com/s3/sla/">Amazon S3 Service Level Agreement</a> for availability</li>
<li>Supports SSL for data in transit and encryption of data at rest</li>
<li>S3 Lifecycle management for automatic migration of objects to other S3 Storage Classes  </li>
</ul>
<h2 id="s3-standard-ia">S3 Standard-IA</h2>
<p>S3 Standard-IA is for data that is accessed less frequently, but requires rapid access when needed. S3 Standard-IA offers the high durability, high throughput, and low latency of S3 Standard, with a low per GB storage price and per GB retrieval fee. This combination of low cost and high performance make S3 Standard-IA ideal for long-term storage, backups, and as a data store for disaster recovery files. </p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Same low latency and high throughput performance of S3 Standard</li>
<li>Designed for durability of 99.999999999% of objects across multiple Availability Zones</li>
<li>Resilient against events that impact an entire Availability Zone</li>
<li><strong>Data is resilient in the event of one entire Availability Zone destruction</strong></li>
<li>Designed for 99.9% availability over a given year</li>
<li>Backed with the <a href="https://aws.amazon.com/s3/sla/">Amazon S3 Service Level Agreement</a> for availability</li>
<li>Supports SSL for data in transit and encryption of data at rest</li>
<li>S3 Lifecycle management for automatic migration of objects to other S3 Storage Classes</li>
</ul>
<h2 id="s3-glacier_1">S3 Glacier</h2>
<p>S3 Glacier is a secure, durable, and low-cost storage class for data archiving. You can reliably store any amount of data at costs that are competitive with or cheaper than on-premises solutions. To keep costs low yet suitable for varying needs, S3 Glacier provides three retrieval options that range from a few minutes to hours. </p>
<p><strong>Key Features:</strong></p>
<ul>
<li>Designed for durability of 99.999999999% of objects across multiple Availability Zones</li>
<li>Data is resilient in the event of one entire Availability Zone destruction</li>
<li>Supports SSL for data in transit and encryption of data at rest</li>
<li>Low-cost design is ideal for long-term archive</li>
<li>Configurable retrieval times, from minutes to hours</li>
<li>S3 PUT API for direct uploads to S3 Glacier, and S3 Lifecycle management for automatic migration of objects</li>
</ul>
<h2 id="performance-across-the-s3-storage-classes">Performance across the S3 Storage Classes</h2>
<p><img alt="image-20200619130000391" src="s3.assets/image-20200619130000391.png" /></p>
<h2 id="cost-considerations">Cost considerations</h2>
<p>If you are planning to archive infrequently accessed data for a period of months or years, the S3 Glacier and S3 Glacier Deep Archive storage classes can reduce your storage costs. </p>
<h1 id="aws-s3-cli">aws s3 cli</h1>
<h2 id="ls">ls</h2>
<div class="hlcode"><pre><span class="n">aws</span> <span class="n">s3</span> <span class="n">ls</span> <span class="n">s3</span><span class="o">:</span><span class="c1">//mybucket --recursive --human-readable --summarize</span>
</pre></div>


<h2 id="cp">cp</h2>
<p>Using <code>aws s3 cp</code> from the <a href="http://aws.amazon.com/cli/">AWS Command-Line Interface (CLI)</a> will require the <code>--recursive</code>parameter to copy multiple files.</p>
<div class="hlcode"><pre><span class="n">aws</span> <span class="n">s3</span> <span class="n">cp</span> <span class="n">s3</span><span class="o">:</span><span class="c1">//myBucket/dir localdir --recursive</span>
</pre></div>


<h2 id="_1"></h2>
<h2 id="sync">sync</h2>
<p>The <code>aws s3 sync</code> command will, by default, copy a whole directory. It will only copy new/modified files.</p>
<div class="hlcode"><pre><span class="n">aws</span> <span class="n">s3</span> <span class="n">sync</span> <span class="n">s3</span><span class="o">:</span><span class="c1">//mybucket/dir localdir</span>
</pre></div>


<h1 id="s3-operation">S3 operation</h1>
<h2 id="etags">etags</h2>
<p>Due to the fact that the ETag for a multipart uploaded object is a MD5 hash of the list of MD5 hashes of each part, the value of ETag changes after you perform the COPY operation. </p>
<p>https://docs.aws.amazon.com/AmazonS3/latest/API/RESTCommonResponseHeaders.html</p>
<p>The entity tag (ETag) is a hash of the object that might not be an MD5 digest of the object data. Whether the ETag is an MD5 digest depends on how the object was created and encrypted. Because the ETag isn't always an MD5 digest, it can't always be used for verifying the integrity of uploaded files.</p>
<h3 id="verify">verify</h3>
<ol>
<li>
<p>Get the base64-encoded MD5 checksum value of the object.</p>
</li>
<li>
<p>Verify the object's integrity during the upload. </p>
</li>
</ol>
<p>This resolution verifies the integrity of objects using the <strong>Content-MD5</strong> header. If your upload is signed with <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/sig-v4-authenticating-requests.html">AWS Signature Version 4</a>, you need to use the <strong>x-amz-content-sha256</strong> header instead. For more information, see <a href="https://docs.aws.amazon.com/cli/latest/topic/s3-faq.html">Does the AWS CLI validate checksums?</a></p>
<p>you're using a <strong>Linux operating system</strong>, run this Open SSL command:</p>
<div class="hlcode"><pre><span class="n">openssl</span> <span class="n">md5</span> <span class="o">-</span><span class="n">binary</span> <span class="n">PATH</span><span class="o">/</span><span class="n">TO</span><span class="o">/</span><span class="kt">FILE</span> <span class="o">|</span> <span class="n">base64</span>
</pre></div>


<p>The response contains the base64-encoded MD5 checksum value, similar to the following: </p>
<div class="hlcode"><pre><span class="n">user</span><span class="err">@</span><span class="n">example</span><span class="o">:/</span><span class="n">home</span><span class="err">$</span> <span class="n">openssl</span> <span class="n">md5</span> <span class="o">-</span><span class="n">binary</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">|</span> <span class="n">base64</span>
                <span class="n">examplemd5value1234567</span><span class="o">==</span>
</pre></div>


<p><strong>Verify the object's integrity during the upload</strong></p>
<p>To verify the MD5 checksum value of the object during its upload to Amazon S3, use the AWS Command Line Interface (AWS CLI) command <a href="https://docs.aws.amazon.com/cli/latest/reference/s3api/put-object.html">aws s3api put-object</a> and include the <strong>--content-md5</strong> option. For the value of <strong>--content-md5</strong>, enter the base64-encoded MD5 checksum value that you calculated, similar to the following:</p>
<div class="hlcode"><pre><span class="n">aws</span> <span class="n">s3api</span> <span class="n">put</span><span class="o">-</span><span class="n">object</span> <span class="o">--</span><span class="n">bucket</span> <span class="n">awsexamplebucket</span> <span class="o">--</span><span class="n">key</span> <span class="n">awsexampleobject</span><span class="p">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">body</span> <span class="n">awsexampleobjectpath</span> <span class="o">--</span><span class="n">content</span><span class="o">-</span><span class="n">md5</span> <span class="n">examplemd5value1234567</span><span class="o">==</span>
</pre></div>


<p>Optionally, if you want to store the MD5 checksum value as metadata (custom HTTP header), you can also add the <strong>--metadata</strong> option in the command, similar to the following:</p>
<div class="hlcode"><pre><span class="n">aws</span> <span class="n">s3api</span> <span class="n">put</span><span class="o">-</span><span class="n">object</span> <span class="o">--</span><span class="n">bucket</span> <span class="n">awsexamplebucket</span> <span class="o">--</span><span class="n">key</span> <span class="n">awsexampleobject</span><span class="p">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">body</span> <span class="n">awsexampleobjectpath</span> <span class="o">--</span><span class="n">content</span><span class="o">-</span><span class="n">md5</span> <span class="n">examplemd5value1234567</span><span class="o">==</span> <span class="o">--</span><span class="n">metadata</span> <span class="n">md5checksum</span><span class="o">=</span><span class="n">examplemd5value1234567</span><span class="o">==</span>
</pre></div>


<p>If the checksum that Amazon S3 calculates during the upload doesn't match the value that you entered for <strong>--content-md5</strong>, Amazon S3 won't store the object. Instead, you receive an error message in response. For more information, see <a href="https://docs.aws.amazon.com/cli/latest/topic/s3-faq.html">Does the AWS CLI validate checksums?</a></p>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-12-12 14:54:32</p>
      </span>
    </div>

    
    
  </body>
</html>