<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>d3js - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Javascript">Javascript</a>&nbsp;&#187;&nbsp;d3js
    <span class="updated">Page Updated&nbsp;
      2020-05-11 23:32
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">d3js</div>

  <p>[toc]</p>
<h1 id="d3">D3</h1>
<p>Data-Driven Documents</p>
<h2 id="installation">installation</h2>
<div class="hlcode"><pre><span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">&quot;https://d3js.org/d3.v5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>


<h1 id="functions">Functions</h1>
<h2 id="append">append</h2>
<p>index.html</p>
<div class="hlcode"><pre><span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;svg</span> <span class="na">width=</span><span class="s">&quot;960&quot;</span> <span class="na">height=</span><span class="s">&quot;500&quot;</span><span class="nt">&gt;&lt;/svg&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</pre></div>


<div class="hlcode"><pre><span class="k">const</span> <span class="n">svg</span> <span class="o">=</span> <span class="n">d3</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="err">&#39;</span><span class="n">svg</span><span class="err">&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="n">circle</span> <span class="o">=</span> <span class="n">svg</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="err">&#39;</span><span class="n">circle</span><span class="err">&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="n">width</span> <span class="o">=</span> <span class="n">parseFload</span><span class="p">(</span><span class="n">svg</span><span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">width</span><span class="err">&#39;</span><span class="p">));</span>
<span class="k">const</span> <span class="n">height</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="n">svg</span><span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">height</span><span class="err">&#39;</span><span class="p">));</span>  <span class="c1">// parse string to number</span>
<span class="n">circle</span><span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="sc">&#39;r&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="n">circle</span><span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">cx</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
<span class="n">circle</span><span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">cy</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
</pre></div>


<h2 id="attr">attr</h2>
<p>combine the attrs</p>
<div class="hlcode"><pre><span class="k">const</span> <span class="n">circle</span> <span class="o">=</span> <span class="n">svg</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="err">&#39;</span><span class="n">circle</span><span class="err">&#39;</span><span class="p">);</span>
    <span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="sc">&#39;r&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">cx</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">cy</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">fill</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">yellow</span><span class="err">&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">stroke</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">black</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<h2 id="csv">csv</h2>
<div class="hlcode"><pre><span class="n">import</span> <span class="p">{</span> <span class="n">select</span><span class="p">,</span> <span class="n">csv</span> <span class="p">}</span> <span class="n">from</span> <span class="err">&#39;</span><span class="n">d3</span><span class="err">&#39;</span><span class="p">;</span>

<span class="k">const</span> <span class="n">svg</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="err">&#39;</span><span class="n">svg</span><span class="err">&#39;</span><span class="p">);</span>

<span class="n">csv</span><span class="p">(</span><span class="err">&#39;</span><span class="n">data</span><span class="p">.</span><span class="n">csv</span><span class="err">&#39;</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<h2 id="select">select</h2>
<div class="hlcode"><pre><span class="n">d3</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="err">&#39;</span><span class="n">svg</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<h2 id="scaleband">scaleBand</h2>
<p>Constructs a new band scale with the specified <a href="https://github.com/d3/d3-scale/blob/v2.2.2/README.md#band_domain"><em>domain</em></a> and <a href="https://github.com/d3/d3-scale/blob/v2.2.2/README.md#band_range"><em>range</em></a>, no <a href="https://github.com/d3/d3-scale/blob/v2.2.2/README.md#band_padding">padding</a>, no <a href="https://github.com/d3/d3-scale/blob/v2.2.2/README.md#band_round">rounding</a> and center <a href="https://github.com/d3/d3-scale/blob/v2.2.2/README.md#band_align">alignment</a>. If <em>domain</em> is not specified, it defaults to the empty domain. If <em>range</em> is not specified, it defaults to the unit range [0, 1].</p>
<p>柱条刻度</p>
<p><img alt="image-20200514220903623" src="d3js.assets/image-20200514220903623.png" /></p>
<h2 id="scalelinear">scaleLinear</h2>
<p>Linear scales are a good default choice for continuous quantitative data because they preserve proportional differences. Each range value <em>y</em> can be expressed as a function of the domain value <em>x</em>: <em>y</em> = <em>mx</em> + <em>b</em>.</p>
<p>数值刻度定义</p>
<p><img alt="image-20200513230203101" src="d3js.assets/image-20200513230203101.png" /></p>
<h3 id="domain">domain</h3>
<p>Data space 数据区域</p>
<h3 id="range">range</h3>
<p>Screen space </p>
<h2 id="_1"></h2>
<h1 id="import-d3-function">import d3 function</h1>
<p>for ES6</p>
<p>Index.js</p>
<div class="hlcode"><pre><span class="n">import</span> <span class="p">{</span> <span class="n">select</span> <span class="p">}</span> <span class="n">from</span> <span class="err">&#39;</span><span class="n">d3</span><span class="err">&#39;</span><span class="p">;</span>

<span class="k">const</span> <span class="n">svg</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="err">&#39;</span><span class="n">svg</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">svg</span><span class="p">.</span><span class="n">style</span><span class="p">(</span><span class="err">&#39;</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">red</span><span class="err">&#39;</span><span class="p">);</span>
</pre></div>


<h1 id="format-convert">format convert</h1>
<h2 id="string-to-number">string to number</h2>
<p>data.csv</p>
<div class="hlcode"><pre><span class="n">country</span><span class="p">,</span><span class="n">population</span>
<span class="n">China</span><span class="p">,</span><span class="mi">1415046</span>
<span class="n">India</span><span class="p">,</span><span class="mi">1364052</span>
<span class="n">United</span> <span class="n">States</span><span class="p">,</span> <span class="mi">326767</span>
<span class="n">Indonesia</span><span class="p">,</span><span class="mi">266795</span>
<span class="n">Brazil</span><span class="p">,</span><span class="mi">210868</span>
<span class="n">Pakistan</span><span class="p">,</span><span class="mi">200814</span>
<span class="n">Nigeria</span><span class="p">,</span><span class="mi">195875</span>
<span class="n">Bangladesh</span><span class="p">,</span><span class="mi">166368</span>
<span class="n">Russia</span><span class="p">,</span><span class="mi">143965</span>
<span class="n">Mexico</span><span class="p">,</span><span class="mi">130759</span>
</pre></div>


<p>index.js</p>
<div class="hlcode"><pre><span class="n">import</span> <span class="p">{</span> <span class="n">select</span><span class="p">,</span> <span class="n">csv</span> <span class="p">}</span> <span class="n">from</span> <span class="err">&#39;</span><span class="n">d3</span><span class="err">&#39;</span><span class="p">;</span>

<span class="k">const</span> <span class="n">svg</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="err">&#39;</span><span class="n">svg</span><span class="err">&#39;</span><span class="p">);</span>

<span class="n">csv</span><span class="p">(</span><span class="err">&#39;</span><span class="n">data</span><span class="p">.</span><span class="n">csv</span><span class="err">&#39;</span><span class="p">).</span><span class="n">then</span><span class="p">(</span><span class="n">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="n">data</span><span class="p">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">d</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="n">d</span><span class="p">.</span><span class="n">population</span> <span class="o">=</span> <span class="o">+</span><span class="n">d</span><span class="p">.</span><span class="n">population</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">//symbal &#39;+&#39; could convert the type</span>
        <span class="p">})</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<h1 id="example">example</h1>
<h2 id="bar-chart">Bar chart</h2>
<div class="hlcode"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>HTML Starter<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;script</span> <span class="na">src=</span><span class="s">&quot;https://d3js.org/d3.v5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;style&gt;</span>
      rect {
        fill: steelblue;
      }
      text {
        font-size: 1.6em;
      }
    <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;svg</span> <span class="na">width=</span><span class="s">&quot;960&quot;</span> <span class="na">height=</span><span class="s">&quot;500&quot;</span><span class="nt">&gt;&lt;/svg&gt;</span>


<span class="nt">&lt;script&gt;</span>
const svg = d3.select(&#39;svg&#39;)
const width = +svg.attr(&#39;width&#39;);
const height = +svg.attr(&#39;height&#39;);

const render = data =&gt; {
  const xValue = d =&gt; d.population;
  const yValue = d =&gt; d.country;
  const margin = {top: 20, right: 20, bottom: 20, left: 100};
  const innerWidth = width - margin.left - margin.right;
  const innerHeight = height - margin.top - margin.bottom;

  const xScale = d3.scaleLinear()
  .domain([0, d3.max(data, xValue)])
  .range([0, innerWidth]);

  const yScale = d3.scaleBand()
  .domain(data.map(yValue))
  .range([0, innerHeight])
  .padding(0.1)

  const g = svg.append(&#39;g&#39;)
  .attr(&#39;transform&#39;, `translate(${margin.left},${margin.top})`)

  g.append(&#39;g&#39;).call(d3.axisLeft(yScale));
  g.append(&#39;g&#39;).call(d3.axisBottom(xScale))  // tranlate it to bottom because it will stay at top by default
  .attr(&#39;transform&#39;, `translate(0, ${innerHeight})`)

  g.selectAll(&#39;rect&#39;).data(data)
  .enter().append(&#39;rect&#39;)
  .attr(&#39;y&#39;, d =&gt; yScale(yValue(d)))
  .attr(&#39;width&#39;, d =&gt; xScale(xValue(d)))
  .attr(&#39;height&#39;, yScale.bandwidth())
};



url = &#39;http://154.201.3.151/data.csv&#39;
d3.csv(url).then(data =&gt; {
  data.forEach(d =&gt; {
    d.population = +d.population * 1000;
  });
  render(data);
})
<span class="nt">&lt;/script&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-12-12 14:54:32</p>
      </span>
    </div>

    
    
  </body>
</html>