<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>awk - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Linux_commands">Linux_commands</a>&nbsp;&#187;&nbsp;awk
    <span class="updated">Page Updated&nbsp;
      2019-01-20 17:43
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">awk</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#awk">awk</a><ul>
<li><a href="#-f">-F 分隔符</a></li>
<li><a href="#-v">-v 变量</a></li>
<li><a href="#regexp">regexp</a></li>
<li><a href="#expression">expression</a></li>
<li><a href="#ranges">ranges</a></li>
</ul>
</li>
<li><a href="#_1">内置变量</a><ul>
<li><a href="#argv">ARGV</a></li>
<li><a href="#argc">ARGC</a></li>
<li><a href="#filename">FILENAME</a></li>
<li><a href="#environ">ENVIRON</a></li>
<li><a href="#empty">Empty</a></li>
<li><a href="#fs">FS分隔符</a></li>
<li><a href="#fnr">FNR</a></li>
<li><a href="#nf">NF 最后一列数据</a></li>
<li><a href="#nr">NR 已读的记录数</a></li>
<li><a href="#begin">BEGIN 开头行</a></li>
<li><a href="#end">END 最后一行</a></li>
<li><a href="#ofs">OFS 输出字段分隔符</a></li>
<li><a href="#ors">ORS 输出记录分隔符</a></li>
<li><a href="#rs">RS 换行符</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="awk">awk</h1>
<div class="hlcode"><pre><span class="n">Usage</span><span class="o">:</span> <span class="n">awk</span> <span class="o">[</span><span class="n">POSIX</span> <span class="n">or</span> <span class="n">GNU</span> <span class="n">style</span> <span class="n">options</span><span class="o">]</span> <span class="o">-</span><span class="n">f</span> <span class="n">progfile</span> <span class="o">[--]</span> <span class="n">file</span> <span class="o">...</span>
<span class="n">Usage</span><span class="o">:</span> <span class="n">awk</span> <span class="o">[</span><span class="n">POSIX</span> <span class="n">or</span> <span class="n">GNU</span> <span class="n">style</span> <span class="n">options</span><span class="o">]</span> <span class="o">[--]</span> <span class="s1">&#39;program&#39;</span> <span class="n">file</span> <span class="o">...</span>
</pre></div>


<h2 id="-f">-F 分隔符</h2>
<div class="hlcode"><pre><span class="cp"># cat /etc/passwd | awk -F : &#39;/^ubuntu/{print $1}&#39;</span>
<span class="n">ubuntu</span>
</pre></div>


<h2 id="-v">-v 变量</h2>
<p>赋值一个用户定义的变量</p>
<h2 id="regexp">regexp</h2>
<div class="hlcode"><pre> <span class="err">格式为</span><span class="o">/</span><span class="n">regular</span> <span class="n">expression</span><span class="o">/</span>
</pre></div>


<div class="hlcode"><pre><span class="cp"># awk -F: &#39;/^r/{print $1}&#39; /etc/passwd</span>
<span class="n">root</span>
<span class="n">rpc</span>
<span class="n">rtkit</span>
<span class="n">radvd</span>
<span class="n">rpcuser</span>
</pre></div>


<h2 id="expression">expression</h2>
<p>表达式，其值为非0 或为非空字符时满足条件，如 </p>
<div class="hlcode"><pre><span class="err">$</span><span class="mi">1</span> <span class="o">~</span> <span class="o">/</span><span class="n">foo</span><span class="o">/</span> <span class="err">或</span> <span class="err">$</span><span class="mi">1</span> <span class="o">==</span> <span class="err">‘</span><span class="n">xurick</span><span class="err">’，</span>
</pre></div>


<p>用运算符~(匹配)和 !~(不匹配) </p>
<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">jp</span> <span class="n">test</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="o">:</span> <span class="err">&#39;$</span><span class="mi">3</span><span class="o">&gt;=</span><span class="mi">500</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">bus</span><span class="o">-</span><span class="n">proxy</span> <span class="mi">999</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">network</span> <span class="mi">998</span>
<span class="n">polkitd</span> <span class="mi">997</span>
<span class="n">ghostlyman</span> <span class="mi">1000</span>
<span class="n">geoclue</span> <span class="mi">996</span>
<span class="n">unbound</span> <span class="mi">995</span>
<span class="n">saslauth</span> <span class="mi">994</span>
<span class="n">chrony</span> <span class="mi">993</span>
<span class="n">colord</span> <span class="mi">992</span>
<span class="n">nfsnobody</span> <span class="mi">65534</span>
<span class="n">setroubleshoot</span> <span class="mi">991</span>
<span class="n">gnome</span><span class="o">-</span><span class="n">initial</span><span class="o">-</span><span class="n">setup</span> <span class="mi">990</span>
<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">jp</span> <span class="n">test</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="o">:</span> <span class="err">&#39;$</span><span class="mi">7</span><span class="o">~</span><span class="s">&quot;bash$&quot;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">7</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="n">root</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">ghostlyman</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">mysql</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>


<h2 id="ranges">ranges</h2>
<p>指定的匹配范围，格式为pattern1 pattern2 </p>
<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">jp</span> <span class="n">test</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="o">:</span> <span class="err">&#39;</span><span class="o">/^</span><span class="n">r</span><span class="o">/</span><span class="p">,</span><span class="o">/^</span><span class="n">m</span><span class="o">/</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">7</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="n">root</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">bin</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">daemon</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">adm</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">lp</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">sync</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sync</span>
<span class="n">shutdown</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">shutdown</span>
<span class="n">halt</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">halt</span>
<span class="n">mail</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">rpc</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">unbound</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">saslauth</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">rtkit</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">pulse</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">chrony</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">colord</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">abrt</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">radvd</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">qemu</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">rpcuser</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">nfsnobody</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">setroubleshoot</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">gdm</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">gnome</span><span class="o">-</span><span class="n">initial</span><span class="o">-</span><span class="n">setup</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">avahi</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
<span class="n">mysql</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">jp</span> <span class="n">test</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="o">:</span> <span class="err">&#39;$</span><span class="mi">3</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="err">$</span><span class="mi">7</span><span class="o">~</span><span class="s">&quot;nologin&quot;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">7</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="n">root</span> <span class="n">x</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">bin</span> <span class="n">x</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</pre></div>


<h1 id="_1">内置变量</h1>
<h2 id="argv">ARGV</h2>
<p>数组，保存命令行本身整个字符串，如awk ‘{print $0}’ a.txt b.txt 整个命令中，ARGV[0]保存awk，ARGV[1]保存a.txt</p>
<h2 id="argc">ARGC</h2>
<p>awk命令的参数个数</p>
<h2 id="filename">FILENAME</h2>
<p>awk处理的文件的名称</p>
<h2 id="environ">ENVIRON</h2>
<p>当前shell环境变量及其值的关联数组   如 awk ‘BEGIN{print ENVIRON[“PATH"]}’</p>
<h2 id="empty">Empty</h2>
<p>(空模式)  匹配任意输入行</p>
<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">jp</span> <span class="n">test</span><span class="p">]</span><span class="err">#</span> <span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="o">:</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">printf</span> <span class="s">&quot;%-10s%-10s-20s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">,</span><span class="err">$</span><span class="mi">7</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="n">root</span>      <span class="mi">0</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">bin</span>       <span class="mi">1</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">daemon</span>    <span class="mi">2</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">adm</span>       <span class="mi">3</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">lp</span>        <span class="mi">4</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">sync</span>      <span class="mi">5</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">shutdown</span>  <span class="mi">6</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">halt</span>      <span class="mi">7</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">mail</span>      <span class="mi">8</span>         <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">operator</span>  <span class="mi">11</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">games</span>     <span class="mi">12</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">ftp</span>       <span class="mi">14</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">nobody</span>    <span class="mi">99</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">avahi</span><span class="o">-</span><span class="n">autoipd170</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">bus</span><span class="o">-</span><span class="n">proxy999</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">network998</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">dbus</span>      <span class="mi">81</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">polkitd</span>   <span class="mi">997</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">ntp</span>       <span class="mi">38</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">tss</span>       <span class="mi">59</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">postfix</span>   <span class="mi">89</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">sshd</span>      <span class="mi">74</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">ghostlyman1000</span>      <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">usbmuxd</span>   <span class="mi">113</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">geoclue</span>   <span class="mi">996</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">rpc</span>       <span class="mi">32</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">unbound</span>   <span class="mi">995</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">saslauth</span>  <span class="mi">994</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">rtkit</span>     <span class="mi">172</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">pulse</span>     <span class="mi">171</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">chrony</span>    <span class="mi">993</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">colord</span>    <span class="mi">992</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">abrt</span>      <span class="mi">173</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">radvd</span>     <span class="mi">75</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">qemu</span>      <span class="mi">107</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">rpcuser</span>   <span class="mi">29</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">nfsnobody</span> <span class="mi">65534</span>     <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">setroubleshoot991</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">gdm</span>       <span class="mi">42</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">gnome</span><span class="o">-</span><span class="n">initial</span><span class="o">-</span><span class="n">setup990</span>       <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">avahi</span>     <span class="mi">70</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
<span class="n">mysql</span>     <span class="mi">27</span>        <span class="o">-</span><span class="mi">20</span><span class="n">s</span>
</pre></div>


<h2 id="fs">FS分隔符</h2>
<p>Field Separator 读取文本时，所使用的字段分隔符</p>
<h2 id="fnr">FNR</h2>
<p>与NR不同的是，FNR用于记录正处理的行是当前这一文件中被总共处理的行数</p>
<h2 id="nf">NF 最后一列数据</h2>
<p>Number of Field   当前记录的field个数</p>
<p>浏览记录的域的个数，即切割后列的个数</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">echo</span> <span class="err">$</span><span class="n">a</span>
<span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>

<span class="err">$</span> <span class="n">echo</span> <span class="err">$</span><span class="n">a</span> <span class="o">|</span> <span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="err">$</span><span class="n">NF</span><span class="p">}</span><span class="err">&#39;</span>
<span class="mi">4</span>
</pre></div>


<h2 id="nr">NR 已读的记录数</h2>
<p>The number of input records: awk命令所处理的记录数，如果有多个文件，这个数目会把处理的多个文件中行统一计数</p>
<p>NF = Number of Fields</p>
<div class="hlcode"><pre><span class="n">awk</span> <span class="err">&#39;</span><span class="n">NF</span><span class="o">==</span><span class="mi">1</span><span class="err">&#39;</span> <span class="n">file_name</span>
</pre></div>


<p>取反</p>
<div class="hlcode"><pre><span class="n">awk</span> <span class="err">&#39;</span><span class="n">NR</span><span class="o">!=</span><span class="mi">1</span><span class="err">&#39;</span> <span class="n">file_name</span>
</pre></div>


<h2 id="begin">BEGIN 开头行</h2>
<h2 id="end">END 最后一行</h2>
<div class="hlcode"><pre><span class="n">awk</span> <span class="s">&quot;END{print $0}&quot;</span> <span class="n">file_name</span>
</pre></div>


<h2 id="ofs">OFS 输出字段分隔符</h2>
<p>Output Field Operator</p>
<p>默认为空格</p>
<div class="hlcode"><pre><span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="sc">&#39; &#39;</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">OFS</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">}{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">num</span><span class="p">.</span><span class="n">txt</span>
</pre></div>


<blockquote>
<p>使用<code>--</code> 进行分割</p>
</blockquote>
<h2 id="ors">ORS 输出记录分隔符</h2>
<p>Output Row Separator </p>
<p>默认为换行符</p>
<div class="hlcode"><pre><span class="n">awk</span> <span class="o">-</span><span class="n">F</span><span class="sc">&#39; &#39;</span> <span class="err">&#39;</span><span class="n">BEGIN</span><span class="p">{</span><span class="n">OFS</span><span class="o">=</span><span class="s">&quot;--&quot;</span><span class="p">;</span><span class="n">ORS</span><span class="o">=</span><span class="s">&quot;#&quot;</span><span class="p">}{</span><span class="n">print</span> <span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">2</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">}</span><span class="err">&#39;</span> <span class="n">num</span><span class="p">.</span><span class="n">txt</span>
</pre></div>


<blockquote>
<p>换行符变为#</p>
</blockquote>
<h2 id="rs">RS 换行符</h2>
<p>Record Separator  输入文本信息所使用的换行符</p>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-12-12 14:54:32</p>
      </span>
    </div>

    
    
  </body>
</html>