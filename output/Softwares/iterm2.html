<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>iterm2 - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Softwares">Softwares</a>&nbsp;&#187;&nbsp;iterm2
    <span class="updated">Page Updated&nbsp;
      2018-12-15 17:56
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">iterm2</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#iterm2">iterm2</a><ul>
<li><a href="#sshpass">sshpass</a></li>
<li><a href="#_1">关闭选中复制</a></li>
<li><a href="#paste">paste 速度</a></li>
<li><a href="#expect">expect 免输入登录</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="iterm2">iterm2</h1>
<h2 id="sshpass">sshpass</h2>
<div class="hlcode"><pre><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="o">:</span><span class="c1">//github.com/kevinburke/sshpass.git</span>
<span class="n">cd</span> <span class="n">sshpass</span>
<span class="p">.</span><span class="o">/</span><span class="n">configure</span>
<span class="n">make</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>


<h2 id="_1">关闭选中复制</h2>
<p>Preferences -&gt; General -&gt; Selection -&gt; <code>Copy to pasteboard on selection</code></p>
<h2 id="paste">paste 速度</h2>
<p>Edit -&gt; Paste Special -&gt; Advanced paste</p>
<p>Chunk size 16B</p>
<p>interchunk Delay 251.19ms </p>
<h2 id="expect">expect 免输入登录</h2>
<p>进入/usr/local/bin目录，新建remote.exp文件，文件内容如下</p>
<table class="hlcodetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="hlcode"><pre><span class="cp">#!/usr/bin/expect</span>
<span class="n">set</span> <span class="n">jumpusr</span> <span class="p">[</span><span class="n">lindex</span> <span class="err">$</span><span class="n">argv</span> <span class="mi">0</span><span class="p">]</span> 
<span class="n">set</span> <span class="n">jumphost</span> <span class="p">[</span><span class="n">lindex</span> <span class="err">$</span><span class="n">argv</span> <span class="mi">1</span><span class="p">]</span> 
<span class="n">set</span> <span class="n">usr</span> <span class="p">[</span><span class="n">lindex</span> <span class="err">$</span><span class="n">argv</span> <span class="mi">2</span><span class="p">]</span> 
<span class="n">set</span> <span class="n">host</span> <span class="p">[</span><span class="n">lindex</span> <span class="err">$</span><span class="n">argv</span> <span class="mi">3</span><span class="p">]</span> 
<span class="n">catch</span> <span class="p">{</span><span class="n">spawn</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">l</span> <span class="err">$</span><span class="n">jumpusr</span> <span class="err">$</span><span class="n">jumphost</span><span class="p">}</span> 
<span class="n">expect</span> <span class="s">&quot;*$jumphost*&quot;</span> <span class="p">{</span> <span class="n">send</span> <span class="s">&quot;ssh -l $usr $host</span><span class="se">\r</span><span class="s">&quot;</span> <span class="p">}</span> 
<span class="n">sleep</span> <span class="mi">2</span>
<span class="n">expect</span> <span class="s">&quot;*$host*&quot;</span> <span class="p">{</span> <span class="n">send</span> <span class="s">&quot;cd ~</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">;</span> <span class="n">interact</span> <span class="p">}</span>
<span class="n">interact</span> <span class="err">#</span> <span class="err">执行完成保持交互状态，把控制权返回控制台</span>
</pre></div>
</td></tr></table>

<p>执行下面命令，修改文件属性为可执行 chmod  777  remote.exp </p>
<p>在iTerm中测试刚才的程序。测试命令格式如下： </p>
<p>// user1为登录堡垒机的用户名<br />
// host1为堡垒机IP地址<br />
// user2为登录目标服务器的用户名 <br />
// host2为目标服务器的IP地址 </p>
<p>remote.exp  user1  host1  user2  host2 </p>
<p>如：remote.exp xiaowang 123.4.56.78 hadoop 132.45.6.89</p>
<table class="hlcodetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="hlcode"><pre><span class="cp">#!/usr/bin/expect</span>
<span class="n">set</span> <span class="n">target_host</span> <span class="p">[</span><span class="n">lindex</span> <span class="err">$</span><span class="n">argv</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">set</span> <span class="n">TERMSERV</span> <span class="mf">8.8.8.8</span>
<span class="n">set</span> <span class="n">USER</span> <span class="n">rxu</span>
<span class="n">set</span> <span class="n">PORT</span> <span class="mi">20002</span>
<span class="n">set</span> <span class="n">PASSWORD</span> <span class="n">xxxxx</span>

<span class="n">spawn</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">p</span> <span class="err">$</span><span class="n">PORT</span> <span class="err">$</span><span class="n">USER</span><span class="err">@$</span><span class="n">TERMSERV</span>
<span class="n">expect</span> <span class="p">{</span>
 <span class="s">&quot;yes/no&quot;</span> <span class="p">{</span><span class="n">send</span> <span class="s">&quot;yes</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">;</span><span class="n">exp_continue</span><span class="p">;}</span>
 <span class="s">&quot;Password:&quot;</span> <span class="p">{</span> <span class="n">send</span> <span class="s">&quot;$PASSWORD</span><span class="se">\r</span><span class="s">&quot;</span> <span class="p">}</span>
 <span class="p">}</span>

<span class="n">expect</span> <span class="s">&quot;bdpops&quot;</span> <span class="p">{</span><span class="n">send</span> <span class="s">&quot;$target_host</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">}</span>
<span class="n">expect</span> <span class="p">{</span>
 <span class="s">&quot;Password:&quot;</span> <span class="p">{</span> <span class="n">send</span> <span class="s">&quot;$PASSWORD</span><span class="se">\r</span><span class="s">&quot;</span> <span class="p">}</span>
 <span class="p">}</span>
<span class="n">expect</span> <span class="s">&quot;rxu@&quot;</span> <span class="p">{</span><span class="n">send</span> <span class="s">&quot;sudo su - </span><span class="se">\r</span><span class="s">&quot;</span><span class="p">}</span>
<span class="n">expect</span> <span class="s">&quot;password for rxu:&quot;</span> <span class="p">{</span><span class="n">send</span> <span class="s">&quot;$PASSWORD</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">}</span>
<span class="n">interact</span>
</pre></div>
</td></tr></table>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-12-12 14:54:32</p>
      </span>
    </div>

    
    
  </body>
</html>